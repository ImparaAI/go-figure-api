sudo: required
services:
  - docker
env:
  global:
  - CLOUDSDK_CORE_DISABLE_PROMPTS=1
cache:
  directories:
  - $HOME/google-cloud-sdk
before_install:
  - openssl aes-256-cbc -K $encrypted_12c8071d2874_key -iv $encrypted_12c8071d2874_iv -in gce-deploy-service-account.json.enc -out gce-deploy-service-account.json -d
before_script:
  - docker-compose up -d
  - sleep 10
script:
  - docker-compose exec api /bin/sh -c "go test -v ./.../test"
deploy:
  provider: script
  script: bash deploy
  on:
    branch: master
notifications:
  email:
    on_success: never